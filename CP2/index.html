
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CP2 - Entrada de Arquivos</title>

<style>
body{
  font-family:Arial,Helvetica,sans-serif;
  background:#0a0a0a;
  color:#4ecca3;
  display:flex;
  flex-direction:column;
  align-items:center;
  margin:0;
  padding:10px;
}

.box{
  width:100%;
  max-width:650px;
  border:1px solid #4ecca3;
  border-radius:8px;
  background:#000;
  overflow:hidden;
  box-shadow:0 0 15px rgba(78,204,163,.2);
}

.preview{
  width:100%;
  height:220px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000;
  color:#888;
  font-size:14px;
}

.controls{
  padding:15px;
  background:#16213e;
  border-top:1px solid #4ecca3;
  text-align:center;
}

.status{
  background:#4ecca3;
  color:#000;
  padding:4px 12px;
  border-radius:20px;
  font-weight:bold;
  font-size:12px;
  display:inline-block;
  margin-bottom:8px;
}

input{
  width:100%;
  margin-top:8px;
  color:white;
}
</style>
</head>

<body>

<div class="box">

  <div id="preview" class="preview">
    aguardando arquivo...
  </div>

  <div class="controls">
    <div class="status" id="status">AGUARDANDO INPUT</div>
    <input type="file" id="fileInput" multiple>
  </div>

</div>

<script>
const input = document.getElementById("fileInput");
const preview = document.getElementById("preview");
const statusTag = document.getElementById("status");

/* envia sinal global para outras CPs */
function enviarParaExtensor(dados){
  localStorage.setItem("EXTENSOR_ARQUIVOS", JSON.stringify(dados));
  localStorage.setItem("EXTENSOR_SINAL", Date.now());
}

input.onchange = () => {

  const files = Array.from(input.files);

  if(!files.length) return;

  statusTag.textContent = "PROCESSANDO...";

  preview.innerHTML = "";

  const listaInfo = [];

  files.forEach(file => {

    const tipo = file.type.split("/")[0];

    listaInfo.push({
      nome: file.name,
      tipo: tipo,
      tamanho: file.size
    });

    /* PREVIEW VISUAL */
    if(tipo === "image"){
      const img = document.createElement("img");
      img.src = URL.createObjectURL(file);
      img.style.maxHeight = "200px";
      preview.appendChild(img);
    }

    else if(tipo === "video"){
      const vid = document.createElement("video");
      vid.src = URL.createObjectURL(file);
      vid.controls = true;
      vid.style.maxHeight = "200px";
      preview.appendChild(vid);
    }

    else if(tipo === "audio"){
      const aud = document.createElement("audio");
      aud.src = URL.createObjectURL(file);
      aud.controls = true;
      preview.appendChild(aud);
    }

    else{
      const txt = document.createElement("div");
      txt.textContent = file.name;
      preview.appendChild(txt);
    }

  });

  statusTag.textContent = "ENVIADO AO EXTENSOR";

  /* comunicação com CP3 e CP4 */
  enviarParaExtensor(listaInfo);

  console.log("CP2 enviou arquivos para o EXTENSOR:", listaInfo);
};
</script>

</body>
</html>

