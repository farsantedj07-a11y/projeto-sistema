
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Núcleo do Extensor</title>

<style>
body{
  font-family:'Courier New',monospace;
  background:#0a0a0a;
  color:#00ff41;
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
  margin:0;
  padding:20px;
}

.panel{
  width:95%;
  max-width:800px;
  border:2px solid #00ff41;
  padding:20px;
  border-radius:10px;
  background:rgba(0,255,65,0.05);
  box-shadow:0 0 20px rgba(0,255,65,0.2);
}

.status-bar{
  display:flex;
  justify-content:space-between;
  border-bottom:1px solid #00ff41;
  padding-bottom:10px;
  margin-bottom:20px;
  font-size:.8rem;
}

.log-container{
  height:300px;
  overflow-y:auto;
  margin-bottom:20px;
}

.log-entry{margin-bottom:5px}

.cursor{
  display:inline-block;
  width:10px;
  height:1.2rem;
  background:#00ff41;
  animation:blink .8s infinite;
  vertical-align:middle;
}

.btn-voltar{
  text-decoration:none;
  color:#00ff41;
  border:1px solid #00ff41;
  padding:10px 20px;
  border-radius:5px;
  transition:.3s;
  margin-top:30px;
}
.btn-voltar:hover{background:#00ff41;color:black}

@keyframes blink{50%{opacity:0}}
</style>
</head>

<body>

<div class="panel">

  <div class="status-bar">
    <span id="sistema">SISTEMA: INICIANDO...</span>
    <span id="estado">ESTADO: AGUARDANDO EXTENSOR</span>
  </div>

  <div class="log-container" id="log"></div>

  <div>> <span id="typing">conectando núcleo...</span><span class="cursor"></span></div>

</div>

<a href="../index.html" class="btn-voltar">VOLTAR AO PAINEL</a>

<script>
/* ================= AUTO DESCOBRIR A PASTA ================= */
const pathParts = window.location.pathname.split("/");
const pastaAtual = pathParts[pathParts.length - 2] || "CP";

/* ================= CONFIG REPOSITÓRIO ================= */
const repoBase =
"https://api.github.com/repos/farsantedj07-a11y/projeto-sistema/contents/";

const repoPasta = repoBase + pastaAtual;

/* ================= ELEMENTOS ================= */
const logDiv = document.getElementById("log");
const sistemaTxt = document.getElementById("sistema");
const estadoTxt = document.getElementById("estado");

/* ================= LOG ================= */
function addLog(msg){
  const div=document.createElement("div");
  div.className="log-entry";
  div.textContent=`[${new Date().toLocaleTimeString()}] ${msg}`;
  logDiv.appendChild(div);
  logDiv.scrollTop=logDiv.scrollHeight;
}

/* ================= LEITURA REAL DA PASTA ================= */
async function lerPasta(){

  try{
    const res = await fetch(repoPasta + "?ref=main");
    const arquivos = await res.json();

    if(!Array.isArray(arquivos)){
      sistemaTxt.textContent="SISTEMA: FALHA AO LER";
      estadoTxt.textContent="ESTADO: ERRO";
      return;
    }

    sistemaTxt.textContent="SISTEMA: " + pastaAtual + " ONLINE";
    estadoTxt.textContent="ESTADO: EXECUTANDO";

    addLog("Arquivos ativos: " + arquivos.length);

    /* ===== procurar log.txt ===== */
    const logFile = arquivos.find(a => a.name.toLowerCase() === "log.txt");

    if(logFile){
      const txt = await fetch(logFile.download_url);
      const conteudo = await txt.text();

      logDiv.innerHTML="";

      conteudo.split("\n").forEach(l=>{
        if(l.trim()) addLog(l);
      });
    }

    /* ===== procurar status.json ===== */
    const statusFile = arquivos.find(a => a.name.toLowerCase() === "status.json");

    if(statusFile){
      const st = await fetch(statusFile.download_url);
      const json = await st.json();

      estadoTxt.textContent = "ESTADO: " + (json.estado || "ATIVO");
    }

  }catch(e){
    sistemaTxt.textContent="SISTEMA: OFFLINE";
    estadoTxt.textContent="ESTADO: SEM CONEXÃO";
  }
}

/* ================= TEMPO REAL DO EXTENSOR ================= */
setInterval(lerPasta, 3000);
lerPasta();
</script>

</body>
</html>
